{"version":3,"file":"mortal-enc.mjs","sources":["../../../../src/tx/signed-extensions/mortal-enc.ts"],"sourcesContent":["import { Bytes, enhanceEncoder, u16 } from \"@polkadot-api/substrate-bindings\"\n\nfunction trailingZeroes(n: number) {\n  let i = 0\n  while (!(n & 1)) {\n    i++\n    n >>= 1\n  }\n  return i\n}\n\nconst nextPower = (n: number) => 1 << Math.ceil(Math.log2(n))\n\nexport const mortal = enhanceEncoder(\n  Bytes(2)[0],\n  (value: { period: number; startAtBlock: number }) => {\n    const period = Math.min(Math.max(nextPower(value.period), 4), 1 << 16)\n    const phase = value.startAtBlock % period\n    const factor = Math.max(period >> 12, 1)\n    const left = Math.min(Math.max(trailingZeroes(period) - 1, 1), 15)\n    const right = (phase / factor) << 4\n    return u16[0](left | right)\n  },\n)\n"],"names":[],"mappings":";;AAEA,SAAS,eAAe,CAAW,EAAA;AACjC,EAAA,IAAI,CAAI,GAAA,CAAA;AACR,EAAO,OAAA,EAAE,IAAI,CAAI,CAAA,EAAA;AACf,IAAA,CAAA,EAAA;AACA,IAAM,CAAA,KAAA,CAAA;AAAA;AAER,EAAO,OAAA,CAAA;AACT;AAEA,MAAM,SAAA,GAAY,CAAC,CAAc,KAAA,CAAA,IAAK,KAAK,IAAK,CAAA,IAAA,CAAK,IAAK,CAAA,CAAC,CAAC,CAAA;AAErD,MAAM,MAAS,GAAA,cAAA;AAAA,EACpB,KAAA,CAAM,CAAC,CAAA,CAAE,CAAC,CAAA;AAAA,EACV,CAAC,KAAoD,KAAA;AACnD,IAAA,MAAM,MAAS,GAAA,IAAA,CAAK,GAAI,CAAA,IAAA,CAAK,GAAI,CAAA,SAAA,CAAU,KAAM,CAAA,MAAM,CAAG,EAAA,CAAC,CAAG,EAAA,CAAA,IAAK,EAAE,CAAA;AACrE,IAAM,MAAA,KAAA,GAAQ,MAAM,YAAe,GAAA,MAAA;AACnC,IAAA,MAAM,MAAS,GAAA,IAAA,CAAK,GAAI,CAAA,MAAA,IAAU,IAAI,CAAC,CAAA;AACvC,IAAM,MAAA,IAAA,GAAO,IAAK,CAAA,GAAA,CAAI,IAAK,CAAA,GAAA,CAAI,cAAe,CAAA,MAAM,CAAI,GAAA,CAAA,EAAG,CAAC,CAAA,EAAG,EAAE,CAAA;AACjE,IAAM,MAAA,KAAA,GAAS,QAAQ,MAAW,IAAA,CAAA;AAClC,IAAA,OAAO,GAAI,CAAA,CAAC,CAAE,CAAA,IAAA,GAAO,KAAK,CAAA;AAAA;AAE9B;;;;"}