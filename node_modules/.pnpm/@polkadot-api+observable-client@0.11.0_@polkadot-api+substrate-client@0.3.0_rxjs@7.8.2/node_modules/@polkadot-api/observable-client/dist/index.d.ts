import * as _polkadot_api_substrate_client from '@polkadot-api/substrate-client';
import { ChainHead, StorageItemInput, StorageResult, UnsubscribeFn, SubstrateClient } from '@polkadot-api/substrate-client';
import * as rxjs from 'rxjs';
import { Observable, ObservableInput } from 'rxjs';
import * as _polkadot_api_substrate_bindings from '@polkadot-api/substrate-bindings';
import { HexString, Decoder, Binary, Codec, SS58String, ResultPayload } from '@polkadot-api/substrate-bindings';
import { MetadataLookup, getDynamicBuilder } from '@polkadot-api/metadata-builders';

type SystemEvent = {
    phase: {
        type: "ApplyExtrinsic";
        value: number;
    } | {
        type: "Finalization";
    } | {
        type: "Initialization";
    };
    event: {
        type: string;
        value: {
            type: string;
            value: any;
        };
    };
    topics: Array<Binary>;
};
interface RuntimeContext {
    metadataRaw: Uint8Array;
    lookup: MetadataLookup;
    codeHash: HexString;
    dynamicBuilder: ReturnType<typeof getDynamicBuilder>;
    events: {
        key: string;
        dec: Decoder<Array<SystemEvent>>;
    };
    accountId: Codec<SS58String>;
    assetId: number | null;
}
interface Runtime {
    at: string;
    runtime: Observable<RuntimeContext>;
    addBlock: (block: string) => Runtime;
    deleteBlocks: (blocks: string[]) => number;
    usages: Set<string>;
}

interface PinnedBlock {
    hash: string;
    number: number;
    parent: string;
    children: Set<string>;
    runtime: string;
    unpinnable: boolean;
    refCount: number;
    recovering: boolean;
}
type PinnedBlocks = {
    best: string;
    finalized: string;
    runtimes: Record<string, Runtime>;
    blocks: Map<string, PinnedBlock>;
    finalizedRuntime: Runtime;
    recovering: boolean;
};

type AnalyzedBlock = {
    hash: HexString;
    found: {
        type: true;
        index: number;
        events: any;
    } | {
        type: false;
        validity: ResultPayload<any, any> | null;
    };
};

type BlockInfo = {
    hash: string;
    number: number;
    parent: string;
};
declare const getChainHead$: (chainHead: ChainHead, getCachedMetadata: (codeHash: string) => Observable<Uint8Array | null>, setCachedMetadata: (codeHash: string, metadataRaw: Uint8Array) => void) => readonly [{
    readonly follow$: rxjs.Connectable<(_polkadot_api_substrate_client.NewBlockWithRuntime | _polkadot_api_substrate_client.BestBlockChanged | _polkadot_api_substrate_client.Finalized | (_polkadot_api_substrate_client.Initialized & {
        number: number;
        parentHash: string;
    })) | {
        type: "stop-error";
    }>;
    readonly finalized$: Observable<BlockInfo>;
    readonly best$: Observable<BlockInfo>;
    readonly bestBlocks$: Observable<BlockInfo[]>;
    readonly newBlocks$: Observable<BlockInfo>;
    readonly runtime$: Observable<RuntimeContext | null>;
    readonly metadata$: Observable<{
        version: 14 | 15 | 16;
        lookup: _polkadot_api_substrate_bindings.V14Lookup;
        pallets: ({
            name: string;
            storage: {
                prefix: string;
                items: ({
                    name: string;
                    modifier: number;
                    type: {
                        tag: "plain";
                        value: number;
                    } | {
                        tag: "map";
                        value: _polkadot_api_substrate_bindings.CodecType<_polkadot_api_substrate_bindings.Codec<{
                            hashers: ({
                                tag: "Blake2128";
                                value: undefined;
                            } | {
                                tag: "Blake2256";
                                value: undefined;
                            } | {
                                tag: "Blake2128Concat";
                                value: undefined;
                            } | {
                                tag: "Twox128";
                                value: undefined;
                            } | {
                                tag: "Twox256";
                                value: undefined;
                            } | {
                                tag: "Twox64Concat";
                                value: undefined;
                            } | {
                                tag: "Identity";
                                value: undefined;
                            })[];
                            key: number;
                            value: number;
                        }>>;
                    };
                    fallback: HexString;
                    docs: string[];
                } | ({
                    name: string;
                    modifier: number;
                    type: {
                        tag: "plain";
                        value: number;
                    } | {
                        tag: "map";
                        value: _polkadot_api_substrate_bindings.CodecType<_polkadot_api_substrate_bindings.Codec<{
                            hashers: ({
                                tag: "Blake2128";
                                value: undefined;
                            } | {
                                tag: "Blake2256";
                                value: undefined;
                            } | {
                                tag: "Blake2128Concat";
                                value: undefined;
                            } | {
                                tag: "Twox128";
                                value: undefined;
                            } | {
                                tag: "Twox256";
                                value: undefined;
                            } | {
                                tag: "Twox64Concat";
                                value: undefined;
                            } | {
                                tag: "Identity";
                                value: undefined;
                            })[];
                            key: number;
                            value: number;
                        }>>;
                    };
                    fallback: HexString;
                    docs: string[];
                } & {
                    deprecationInfo: _polkadot_api_substrate_bindings.CodecType<_polkadot_api_substrate_bindings.Codec<{
                        tag: "NotDeprecated";
                        value: undefined;
                    } | {
                        tag: "DeprecatedWithoutNote";
                        value: undefined;
                    } | {
                        tag: "Deprecated";
                        value: {
                            note: string;
                            since: string | undefined;
                        };
                    }>>;
                }))[];
            } | undefined;
            calls: {
                type: number;
            } | ({
                type: number;
            } & {
                deprecationInfo: _polkadot_api_substrate_bindings.CodecType<_polkadot_api_substrate_bindings.Codec<{
                    index: number;
                    deprecation: {
                        tag: "DeprecatedWithoutNote";
                        value: undefined;
                    } | {
                        tag: "Deprecated";
                        value: {
                            note: string;
                            since: string | undefined;
                        };
                    };
                }[]>>;
            }) | undefined;
            events: {
                type: number;
            } | ({
                type: number;
            } & {
                deprecationInfo: _polkadot_api_substrate_bindings.CodecType<_polkadot_api_substrate_bindings.Codec<{
                    index: number;
                    deprecation: {
                        tag: "DeprecatedWithoutNote";
                        value: undefined;
                    } | {
                        tag: "Deprecated";
                        value: {
                            note: string;
                            since: string | undefined;
                        };
                    };
                }[]>>;
            }) | undefined;
            constants: ({
                name: string;
                type: number;
                value: HexString;
                docs: string[];
            } | ({
                name: string;
                type: number;
                value: HexString;
                docs: string[];
            } & {
                deprecationInfo: _polkadot_api_substrate_bindings.CodecType<_polkadot_api_substrate_bindings.Codec<{
                    tag: "NotDeprecated";
                    value: undefined;
                } | {
                    tag: "DeprecatedWithoutNote";
                    value: undefined;
                } | {
                    tag: "Deprecated";
                    value: {
                        note: string;
                        since: string | undefined;
                    };
                }>>;
            }))[];
            errors: {
                type: number;
            } | ({
                type: number;
            } & {
                deprecationInfo: _polkadot_api_substrate_bindings.CodecType<_polkadot_api_substrate_bindings.Codec<{
                    index: number;
                    deprecation: {
                        tag: "DeprecatedWithoutNote";
                        value: undefined;
                    } | {
                        tag: "Deprecated";
                        value: {
                            note: string;
                            since: string | undefined;
                        };
                    };
                }[]>>;
            }) | undefined;
            associatedTypes: Array<{
                name: string;
                type: number;
                docs: string[];
            }>;
            viewFns: Array<_polkadot_api_substrate_bindings.CodecType<_polkadot_api_substrate_bindings.Codec<{
                deprecationInfo: {
                    tag: "NotDeprecated";
                    value: undefined;
                } | {
                    tag: "DeprecatedWithoutNote";
                    value: undefined;
                } | {
                    tag: "Deprecated";
                    value: {
                        note: string;
                        since: string | undefined;
                    };
                };
                name: string;
                inputs: {
                    name: string;
                    type: number;
                }[];
                output: number;
                docs: string[];
                id: HexString;
            }>>>;
            index: number;
            docs: string[];
        } | ({
            name: string;
            storage: {
                prefix: string;
                items: ({
                    name: string;
                    modifier: number;
                    type: {
                        tag: "plain";
                        value: number;
                    } | {
                        tag: "map";
                        value: _polkadot_api_substrate_bindings.CodecType<_polkadot_api_substrate_bindings.Codec<{
                            hashers: ({
                                tag: "Blake2128";
                                value: undefined;
                            } | {
                                tag: "Blake2256";
                                value: undefined;
                            } | {
                                tag: "Blake2128Concat";
                                value: undefined;
                            } | {
                                tag: "Twox128";
                                value: undefined;
                            } | {
                                tag: "Twox256";
                                value: undefined;
                            } | {
                                tag: "Twox64Concat";
                                value: undefined;
                            } | {
                                tag: "Identity";
                                value: undefined;
                            })[];
                            key: number;
                            value: number;
                        }>>;
                    };
                    fallback: HexString;
                    docs: string[];
                } | ({
                    name: string;
                    modifier: number;
                    type: {
                        tag: "plain";
                        value: number;
                    } | {
                        tag: "map";
                        value: _polkadot_api_substrate_bindings.CodecType<_polkadot_api_substrate_bindings.Codec<{
                            hashers: ({
                                tag: "Blake2128";
                                value: undefined;
                            } | {
                                tag: "Blake2256";
                                value: undefined;
                            } | {
                                tag: "Blake2128Concat";
                                value: undefined;
                            } | {
                                tag: "Twox128";
                                value: undefined;
                            } | {
                                tag: "Twox256";
                                value: undefined;
                            } | {
                                tag: "Twox64Concat";
                                value: undefined;
                            } | {
                                tag: "Identity";
                                value: undefined;
                            })[];
                            key: number;
                            value: number;
                        }>>;
                    };
                    fallback: HexString;
                    docs: string[];
                } & {
                    deprecationInfo: _polkadot_api_substrate_bindings.CodecType<_polkadot_api_substrate_bindings.Codec<{
                        tag: "NotDeprecated";
                        value: undefined;
                    } | {
                        tag: "DeprecatedWithoutNote";
                        value: undefined;
                    } | {
                        tag: "Deprecated";
                        value: {
                            note: string;
                            since: string | undefined;
                        };
                    }>>;
                }))[];
            } | undefined;
            calls: {
                type: number;
            } | ({
                type: number;
            } & {
                deprecationInfo: _polkadot_api_substrate_bindings.CodecType<_polkadot_api_substrate_bindings.Codec<{
                    index: number;
                    deprecation: {
                        tag: "DeprecatedWithoutNote";
                        value: undefined;
                    } | {
                        tag: "Deprecated";
                        value: {
                            note: string;
                            since: string | undefined;
                        };
                    };
                }[]>>;
            }) | undefined;
            events: {
                type: number;
            } | ({
                type: number;
            } & {
                deprecationInfo: _polkadot_api_substrate_bindings.CodecType<_polkadot_api_substrate_bindings.Codec<{
                    index: number;
                    deprecation: {
                        tag: "DeprecatedWithoutNote";
                        value: undefined;
                    } | {
                        tag: "Deprecated";
                        value: {
                            note: string;
                            since: string | undefined;
                        };
                    };
                }[]>>;
            }) | undefined;
            constants: ({
                name: string;
                type: number;
                value: HexString;
                docs: string[];
            } | ({
                name: string;
                type: number;
                value: HexString;
                docs: string[];
            } & {
                deprecationInfo: _polkadot_api_substrate_bindings.CodecType<_polkadot_api_substrate_bindings.Codec<{
                    tag: "NotDeprecated";
                    value: undefined;
                } | {
                    tag: "DeprecatedWithoutNote";
                    value: undefined;
                } | {
                    tag: "Deprecated";
                    value: {
                        note: string;
                        since: string | undefined;
                    };
                }>>;
            }))[];
            errors: {
                type: number;
            } | ({
                type: number;
            } & {
                deprecationInfo: _polkadot_api_substrate_bindings.CodecType<_polkadot_api_substrate_bindings.Codec<{
                    index: number;
                    deprecation: {
                        tag: "DeprecatedWithoutNote";
                        value: undefined;
                    } | {
                        tag: "Deprecated";
                        value: {
                            note: string;
                            since: string | undefined;
                        };
                    };
                }[]>>;
            }) | undefined;
            associatedTypes: Array<{
                name: string;
                type: number;
                docs: string[];
            }>;
            viewFns: Array<_polkadot_api_substrate_bindings.CodecType<_polkadot_api_substrate_bindings.Codec<{
                deprecationInfo: {
                    tag: "NotDeprecated";
                    value: undefined;
                } | {
                    tag: "DeprecatedWithoutNote";
                    value: undefined;
                } | {
                    tag: "Deprecated";
                    value: {
                        note: string;
                        since: string | undefined;
                    };
                };
                name: string;
                inputs: {
                    name: string;
                    type: number;
                }[];
                output: number;
                docs: string[];
                id: HexString;
            }>>>;
            index: number;
            docs: string[];
        } & {
            deprecationInfo: _polkadot_api_substrate_bindings.CodecType<_polkadot_api_substrate_bindings.Codec<{
                tag: "NotDeprecated";
                value: undefined;
            } | {
                tag: "DeprecatedWithoutNote";
                value: undefined;
            } | {
                tag: "Deprecated";
                value: {
                    note: string;
                    since: string | undefined;
                };
            }>>;
        }))[];
        extrinsic: {
            version: number[];
            signedExtensions: Array<{
                identifier: string;
                type: number;
                additionalSigned: number;
            }>;
        } & (({
            type: number;
        } | {
            address: number;
            call: number;
            signature: number;
        }) & ({} | {
            signedExtensionsByVersion: Array<[number, number[]]>;
        }));
        apis: ({
            name: string;
            methods: ({
                name: string;
                inputs: Array<{
                    name: string;
                    type: number;
                }>;
                output: number;
                docs: string[];
            } | ({
                name: string;
                inputs: Array<{
                    name: string;
                    type: number;
                }>;
                output: number;
                docs: string[];
            } & {
                deprecationInfo: _polkadot_api_substrate_bindings.CodecType<_polkadot_api_substrate_bindings.Codec<{
                    tag: "NotDeprecated";
                    value: undefined;
                } | {
                    tag: "DeprecatedWithoutNote";
                    value: undefined;
                } | {
                    tag: "Deprecated";
                    value: {
                        note: string;
                        since: string | undefined;
                    };
                }>>;
            }))[];
            docs: string[];
        } & (({} | {
            version: number;
        }) & ({} | {
            deprecationInfo: _polkadot_api_substrate_bindings.CodecType<_polkadot_api_substrate_bindings.Codec<{
                tag: "NotDeprecated";
                value: undefined;
            } | {
                tag: "DeprecatedWithoutNote";
                value: undefined;
            } | {
                tag: "Deprecated";
                value: {
                    note: string;
                    since: string | undefined;
                };
            }>>;
        })))[];
    } | null>;
    readonly genesis$: Observable<string & {
        __hexString?: unknown;
    }>;
    readonly header$: (hash: string | null) => Observable<{
        parentHash: HexString;
        number: number;
        stateRoot: HexString;
        extrinsicRoot: HexString;
        digests: _polkadot_api_substrate_bindings.Enum<{
            consensus: {
                engine: string;
                payload: HexString;
            };
            seal: {
                engine: string;
                payload: HexString;
            };
            preRuntime: {
                engine: string;
                payload: HexString;
            };
            runtimeUpdated: undefined;
        }>[];
    }>;
    readonly body$: (hash: string) => Observable<string[]>;
    readonly call$: (hash: string | null, fn: string, args: string) => Observable<string>;
    readonly storage$: <Type extends StorageItemInput["type"], M extends undefined | ((data: StorageResult<Type>, ctx: RuntimeContext) => any)>(hash: string | null, type: Type, keyMapper: (ctx: RuntimeContext) => string, childTrie?: string | null | undefined, mapper?: M | undefined) => Observable<undefined extends M ? StorageResult<Type> : {
        raw: StorageResult<Type>;
        mapped: ReturnType<NonNullable<M>>;
    }>;
    readonly storageQueries$: (hash: string | null, queries: StorageItemInput[], childTrie?: string | undefined) => Observable<_polkadot_api_substrate_client.StorageItemResponse>;
    readonly eventsAt$: (hash: string | null) => Observable<SystemEvent[]>;
    readonly holdBlock: (hash: string) => () => void;
    readonly trackTx$: (tx: string) => Observable<AnalyzedBlock>;
    readonly trackTxWithoutEvents$: (tx: string) => Observable<AnalyzedBlock>;
    readonly validateTx$: (blockHash: string, tx: string) => Observable<_polkadot_api_substrate_bindings.ResultPayload<any, any>>;
    readonly pinnedBlocks$: Observable<PinnedBlocks>;
    readonly withRuntime: <T>(mapper: (x: T) => string) => (source$: Observable<T>) => Observable<[T, RuntimeContext]>;
    readonly getRuntimeContext$: (hash: string | null) => Observable<RuntimeContext>;
    readonly unfollow: () => void;
}, (_nSubscribers: number) => void];
type ChainHead$ = ReturnType<typeof getChainHead$>[0];

declare class BlockNotPinnedError extends Error {
    constructor(hash: string, label: string);
}

interface ObservableClient {
    chainHead$: (nSubscribers?: number) => ChainHead$;
    broadcastTx$: (transaction: string) => Observable<never>;
    destroy: UnsubscribeFn;
}
declare const getObservableClient: (substrateClient: SubstrateClient, cache?: Partial<{
    getMetadata: (codeHash: string) => Observable<Uint8Array | null>;
    setMetadata: (codeHash: string, rawMetadata: Uint8Array) => void;
}>) => ObservableClient;

declare const isBestOrFinalizedBlock: (blocks$: Observable<PinnedBlocks>, blockHash: string) => Observable<"best" | "finalized" | null>;

declare const concatMapEager: <I, O>(mapper: (outterValue: I, index: number) => ObservableInput<O>, concurrent?: number) => (source$: Observable<I>) => Observable<O>;

export { BlockNotPinnedError, concatMapEager, getObservableClient, isBestOrFinalizedBlock };
export type { AnalyzedBlock, BlockInfo, ChainHead$, ObservableClient, PinnedBlock, PinnedBlocks, RuntimeContext, SystemEvent };
