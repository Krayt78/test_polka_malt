import {
  BehaviorSubject,
  Observable,
  firstValueFrom,
  map,
  of,
  switchMap
} from "./chunk-2T3XQHSK.js";
import {
  __privateAdd,
  __privateGet,
  __privateMethod,
  __privateSet,
  __publicField
} from "./chunk-B4Q33VKO.js";

// node_modules/.pnpm/@reactive-dot+core@0.40.4_polkadot-api@1.12.2_jiti@2.4.2_postcss@8.5.4_rxjs@7.8.2_/node_modules/@reactive-dot/core/build/wallets/provider.js
var WalletProvider = class {
};

// node_modules/.pnpm/@reactive-dot+core@0.40.4_polkadot-api@1.12.2_jiti@2.4.2_postcss@8.5.4_rxjs@7.8.2_/node_modules/@reactive-dot/core/build/storage.js
var _storage, _Storage_instances, prefixKey_fn;
var _Storage = class _Storage {
  constructor(options) {
    __privateAdd(this, _Storage_instances);
    __publicField(this, "prefix");
    __privateAdd(this, _storage);
    this.prefix = options.prefix;
    __privateSet(this, _storage, options.storage);
  }
  getItem(key) {
    return __privateGet(this, _storage).getItem(__privateMethod(this, _Storage_instances, prefixKey_fn).call(this, key));
  }
  removeItem(key) {
    return __privateGet(this, _storage).removeItem(__privateMethod(this, _Storage_instances, prefixKey_fn).call(this, key));
  }
  setItem(key, value) {
    return __privateGet(this, _storage).setItem(__privateMethod(this, _Storage_instances, prefixKey_fn).call(this, key), value);
  }
  join(path) {
    return new _Storage({
      prefix: `${this.prefix}/${path}`,
      storage: __privateGet(this, _storage)
    });
  }
};
_storage = new WeakMap();
_Storage_instances = new WeakSet();
prefixKey_fn = function(key) {
  return `${this.prefix}/${key}`;
};
var Storage = _Storage;
var defaultStorage = new Storage({
  prefix: "@reactive-dot",
  storage: globalThis.localStorage
});

// node_modules/.pnpm/@reactive-dot+core@0.40.4_polkadot-api@1.12.2_jiti@2.4.2_postcss@8.5.4_rxjs@7.8.2_/node_modules/@reactive-dot/core/build/wallets/wallet.js
var _storage2;
var Wallet = class {
  constructor(options) {
    __publicField(this, "options");
    __privateAdd(this, _storage2);
    this.options = options;
    __privateSet(this, _storage2, ((options == null ? void 0 : options.storage) ?? defaultStorage).join("wallet"));
  }
  get storage() {
    return __privateGet(this, _storage2).join(this.id);
  }
  getAccounts() {
    return firstValueFrom(this.accounts$, { defaultValue: [] });
  }
};
_storage2 = new WeakMap();

// node_modules/.pnpm/@reactive-dot+core@0.40.4_polkadot-api@1.12.2_jiti@2.4.2_postcss@8.5.4_rxjs@7.8.2_/node_modules/@reactive-dot/core/build/wallets/deep-link-wallet.js
var DeepLinkWallet = class extends Wallet {
};

// node_modules/.pnpm/@reactive-dot+core@0.40.4_polkadot-api@1.12.2_jiti@2.4.2_postcss@8.5.4_rxjs@7.8.2_/node_modules/@reactive-dot/core/build/actions/initialize-wallets.js
var initializedWallets = /* @__PURE__ */ new Set();
function initializeWallets(wallets) {
  return Promise.all(wallets.map(async (wallet) => {
    if (!initializedWallets.has(wallet)) {
      await wallet.initialize();
      initializedWallets.add(wallet);
    }
  }));
}

// node_modules/.pnpm/@reactive-dot+core@0.40.4_polkadot-api@1.12.2_jiti@2.4.2_postcss@8.5.4_rxjs@7.8.2_/node_modules/@reactive-dot/core/build/errors.js
var BaseError = class extends Error {
  static from(error, message) {
    return new this(message ?? (error instanceof Error ? error.message : void 0), { cause: error });
  }
};
var QueryError = class extends BaseError {
};
var MutationError = class extends BaseError {
};
var ReactiveDotError = BaseError;

// node_modules/.pnpm/@reactive-dot+core@0.40.4_polkadot-api@1.12.2_jiti@2.4.2_postcss@8.5.4_rxjs@7.8.2_/node_modules/@reactive-dot/core/build/wallets/injected/wallet.js
var _extension$, _InjectedWallet_instances, withIds_fn;
var InjectedWallet = class extends Wallet {
  constructor(name, options) {
    super(options);
    __privateAdd(this, _InjectedWallet_instances);
    __publicField(this, "name");
    __privateAdd(this, _extension$, new BehaviorSubject(void 0));
    __publicField(this, "connected$", __privateGet(this, _extension$).pipe(map((extension) => extension !== void 0)));
    __publicField(this, "accounts$", __privateGet(this, _extension$).pipe(switchMap((extension) => {
      if (extension === void 0) {
        return of([]);
      }
      return new Observable((subscriber) => {
        subscriber.next(__privateMethod(this, _InjectedWallet_instances, withIds_fn).call(this, extension.getAccounts()));
        subscriber.add(extension.subscribe((accounts) => subscriber.next(__privateMethod(this, _InjectedWallet_instances, withIds_fn).call(this, accounts))));
      });
    })));
    this.name = name;
  }
  get id() {
    return `injected/${this.name}`;
  }
  async initialize() {
    if (this.storage.getItem("connected") !== null) {
      await this.connect();
    }
  }
  async connect() {
    var _a;
    if (__privateGet(this, _extension$).getValue() === void 0) {
      const { connectInjectedExtension } = await import("./pjs-signer-OUPCTXU7.js");
      __privateGet(this, _extension$).next(await connectInjectedExtension(this.name, (_a = this.options) == null ? void 0 : _a.originName));
      this.storage.setItem("connected", JSON.stringify(true));
    }
  }
  disconnect() {
    var _a;
    (_a = __privateGet(this, _extension$).getValue()) == null ? void 0 : _a.disconnect();
    __privateGet(this, _extension$).next(void 0);
    this.storage.removeItem("connected");
  }
  getAccounts() {
    const extension = __privateGet(this, _extension$).getValue();
    if (extension === void 0) {
      throw new BaseError("Extension is not connected");
    }
    return __privateMethod(this, _InjectedWallet_instances, withIds_fn).call(this, extension.getAccounts());
  }
};
_extension$ = new WeakMap();
_InjectedWallet_instances = new WeakSet();
withIds_fn = function(accounts) {
  return accounts.map((account, index) => ({
    id: index.toString(),
    ...account
  }));
};

// node_modules/.pnpm/@reactive-dot+core@0.40.4_polkadot-api@1.12.2_jiti@2.4.2_postcss@8.5.4_rxjs@7.8.2_/node_modules/@reactive-dot/core/build/wallets/injected/provider.js
var InjectedWalletProvider = class extends WalletProvider {
  constructor(options) {
    super();
    __publicField(this, "options");
    this.options = options;
  }
  async getWallets() {
    const { getInjectedExtensions } = await import("./pjs-signer-OUPCTXU7.js");
    return getInjectedExtensions().map((name) => new InjectedWallet(name, this.options));
  }
};

// node_modules/.pnpm/@reactive-dot+core@0.40.4_polkadot-api@1.12.2_jiti@2.4.2_postcss@8.5.4_rxjs@7.8.2_/node_modules/@reactive-dot/core/build/wallets/local-wallet.js
var LocalWallet = class extends Wallet {
};

export {
  BaseError,
  QueryError,
  MutationError,
  ReactiveDotError,
  Storage,
  WalletProvider,
  Wallet,
  DeepLinkWallet,
  initializeWallets,
  InjectedWallet,
  InjectedWalletProvider,
  LocalWallet
};
//# sourceMappingURL=chunk-OVJJME56.js.map
